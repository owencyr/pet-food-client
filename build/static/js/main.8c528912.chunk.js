(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{201:function(e,t,n){},202:function(e,t,n){},203:function(e,t,n){},204:function(e,t,n){},205:function(e,t,n){},206:function(e,t,n){},207:function(e,t,n){"use strict";n.r(t);var a,r,o=n(0),s=n.n(o),i=n(77),c=n.n(i),l=n(8),u=n(2),m=n(3),d=n(5),h=n(4),f=n(6),g=s.a.createContext({foodList:[],ingredientsList:[],ratingsList:[],userRatedFoods:[],query:null,loggedIn:!1,error:null,setError:function(){},clearError:function(){},setFoodList:function(){},setIngredientsList:function(){},setRatingsList:function(){},setUserRatedFoods:function(){},updateLoggedIn:function(){}}),p=g,b=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={foodList:null,ingredientsList:null,ratingsList:null,userRatedFoods:null,query:null,loggedIn:!1,error:null},n.setFoodList=function(e){n.setState({foodList:e})},n.setIngredientsList=function(e){n.setState({ingredientsList:e})},n.setRatingsList=function(e){n.setState({ratingsList:e})},n.setUserRatedFoods=function(e){n.setState({userRatedFoods:e})},n.setQuery=function(e){n.setState({query:e})},n.updateLoggedIn=function(){n.setState({loggedIn:null!==window.localStorage.getItem("userid")})},n.setError=function(e){console.error(e),n.setState({error:e})},n.clearError=function(){n.setState({error:null})},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e={foodList:this.state.foodList,ingredientsList:this.state.ingredientsList,ratingsList:this.state.ratingsList,userRatedFoods:this.state.userRatedFoods,query:this.state.query,loggedIn:this.state.loggedIn,error:this.state.error,setError:this.setError,clearError:this.clearError,setFoodList:this.setFoodList,setIngredientsList:this.setIngredientsList,setRatingsList:this.setRatingsList,setUserRatedFoods:this.setUserRatedFoods,setQuery:this.setQuery,updateLoggedIn:this.updateLoggedIn};return s.a.createElement(g.Provider,{value:e},this.props.children)}}]),t}(o.Component),E=n(16),v=n(78),y=n.n(v),j="https://ancient-taiga-68163.herokuapp.com/api",k="pet-food-client-auth-token",_={saveAuthToken:function(e){window.localStorage.setItem(k,e)},saveUserMetadata:function(e,t){window.localStorage.setItem("userid",e),window.localStorage.setItem("nickname",t)},getAuthToken:function(){return window.localStorage.getItem(k)},clearAuthToken:function(){window.localStorage.removeItem(k)},clearUserMetadata:function(){window.localStorage.removeItem("userid"),window.localStorage.removeItem("nickname")},hasAuthToken:function(){return!!_.getAuthToken()},makeBasicAuthToken:function(e,t){return window.btoa("".concat(e,":").concat(t))},parseJwt:function(e){return y()(e)},readJwtToken:function(){return _.parseJwt(_.getAuthToken())},_getMsUntilExpiry:function(e){return 1e3*e.exp-Date.now()},queueCallbackBeforeExpiry:function(e){var t=_._getMsUntilExpiry(_.readJwtToken());a=setTimeout(e,t-1e4)},clearCallbackBeforeExpiry:function(){clearTimeout(a)}},L=_,O=null,w=["mousedown","mousemove","keypress","scroll","touchstart"],N={setIdleCallback:function(e){O=e},resetIdleTimer:function(e){clearTimeout(r),r=setTimeout(O,3e5)},registerIdleTimerResets:function(){w.forEach(function(e){return document.addEventListener(e,N.resetIdleTimer,!0)})},unRegisterIdleResets:function(){clearTimeout(r),w.forEach(function(e){return document.removeEventListener(e,N.resetIdleTimer,!0)})}},F=N,R=(n(90),function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).handleLogoutClick=function(){L.clearAuthToken(),L.clearUserMetadata(),n.context.updateLoggedIn(),L.clearCallbackBeforeExpiry(),F.unRegisterIdleResets()},n.formatNickName=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"renderLogoutLink",value:function(){var e=this.formatNickName(window.localStorage.getItem("nickname"));return s.a.createElement("div",{className:"Header__logged-in"},s.a.createElement("span",{className:"User__greeting"},"Hello, ".concat(e)),s.a.createElement(l.b,{onClick:this.handleLogoutClick,to:"/"},"Logout"))}},{key:"renderLoginLink",value:function(){return s.a.createElement("div",{className:"Header__not-logged-in"},s.a.createElement(l.b,{to:"/login"},"Log in"),s.a.createElement(l.b,{to:"/register"},"Register"))}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("nav",{className:"Header"},s.a.createElement("h1",null,s.a.createElement(l.b,{to:"/"},"Pet Food Shopper")),s.a.createElement("span",{className:"Header__tagline--wide"},"Pet Nutrition, Simplified"),L.hasAuthToken()?this.renderLogoutLink():this.renderLoginLink()),s.a.createElement("span",{className:"Header__tagline--narrow"},"Pet Nutrition, Simplified"))}}]),t}(o.Component));R.contextType=p;var I=n(12);function S(e){var t=e.component,n=Object(I.a)(e,["component"]),a=t;return s.a.createElement(E.b,Object.assign({},n,{render:function(e){return L.hasAuthToken()?s.a.createElement(a,e):s.a.createElement(E.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}function T(e){var t=e.component,n=Object(I.a)(e,["component"]),a=t;return s.a.createElement(E.b,Object.assign({},n,{render:function(e){return L.hasAuthToken()?s.a.createElement(E.a,{to:"/"}):s.a.createElement(a,e)}}))}n(81),n(201);function x(e){var t=e.className,n=Object(I.a)(e,["className"]);return s.a.createElement("button",Object.assign({className:["Button",t].join(" ")},n))}function A(e){var t=e.className,n=Object(I.a)(e,["className"]);return s.a.createElement("input",Object.assign({className:["Input",t].join(" ")},n))}function C(e){var t=e.className,n=Object(I.a)(e,["className"]);return s.a.createElement("span",Object.assign({className:["Required",t].join(" ")},n),"*")}function P(e){var t=e.className,n=e.list,a=Object(I.a)(e,["className","list"]),r=["Section",n&&"Section--list",t].filter(Boolean).join(" ");return s.a.createElement("section",Object.assign({className:r},a))}var U={postUser:function(e){return fetch("".concat(j,"/users"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},postLogin:function(e){var t=e.user_name,n=e.password;return fetch("".concat(j,"/auth/login"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user_name:t,password:n})}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})}).then(function(e){return L.saveAuthToken(e.authToken),L.saveUserMetadata(e.user_id,e.nickname),F.registerIdleTimerResets(),L.queueCallbackBeforeExpiry(function(){U.postRefreshToken()}),e})},postRefreshToken:function(){return fetch("".concat(j,"/auth/refresh"),{method:"POST",headers:{authorization:"Bearer ".concat(L.getAuthToken())}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})}).then(function(e){return L.saveAuthToken(e.authToken),L.queueCallbackBeforeExpiry(function(){U.postRefreshToken()}),e}).catch(function(e){console.log("refresh token request error"),console.error(e)})}},q=U,B=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={error:null},n.handleSubmitJwtAuth=function(e){e.preventDefault(),n.setState({error:null});var t=e.target,a=t.user_name,r=t.password;q.postLogin({user_name:a.value,password:r.value}).then(function(e){a.value="",r.value="",n.props.onLoginSuccess()}).catch(function(e){n.setState({error:e.error})})},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.error;return s.a.createElement("form",{className:"LoginForm",onSubmit:this.handleSubmitJwtAuth},s.a.createElement("div",{role:"alert"},e&&s.a.createElement("p",{className:"red"},e)),s.a.createElement("div",{className:"user_name"},s.a.createElement("label",{htmlFor:"LoginForm__user_name"},"User name"),s.a.createElement(A,{required:!0,name:"user_name",id:"LoginForm__user_name"})),s.a.createElement("div",{className:"password"},s.a.createElement("label",{htmlFor:"LoginForm__password"},"Password"),s.a.createElement(A,{required:!0,name:"password",type:"password",id:"LoginForm__password"})),s.a.createElement(x,{type:"submit"},"Login"))}}]),t}(o.Component);B.defaultProps={onLoginSuccess:function(){}};var D=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).handleLoginSuccess=function(){n.context.updateLoggedIn();var e=n.props,t=e.location,a=e.history,r=(t.state||{}).from||"/";a.push(r)},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement(P,{className:"LoginPage"},s.a.createElement("h2",null,"Login"),s.a.createElement(B,{onLoginSuccess:this.handleLoginSuccess}))}}]),t}(o.Component);D.contextType=p,D.defaultProps={location:{},history:{push:function(){}}};var J=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={error:null},n.handleSubmit=function(e){e.preventDefault();var t=e.target,a=t.full_name,r=t.nick_name,o=t.user_name,s=t.password;n.setState({error:null}),q.postUser({user_name:o.value,password:s.value,full_name:a.value,nickname:r.value}).then(function(e){a.value="",r.value="",o.value="",s.value="",n.props.onRegistrationSuccess()}).catch(function(e){n.setState({error:e.error})})},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.error;return s.a.createElement("form",{className:"RegistrationForm",onSubmit:this.handleSubmit},s.a.createElement("div",{role:"alert"},e&&s.a.createElement("p",{className:"red"},e)),s.a.createElement("div",{className:"full_name"},s.a.createElement("label",{htmlFor:"RegistrationForm__full_name"},"Full name ",s.a.createElement(C,null)),s.a.createElement(A,{name:"full_name",type:"text",required:!0,id:"RegistrationForm__full_name"})),s.a.createElement("div",{className:"user_name"},s.a.createElement("label",{htmlFor:"RegistrationForm__user_name"},"User name ",s.a.createElement(C,null)),s.a.createElement(A,{name:"user_name",type:"text",required:!0,id:"RegistrationForm__user_name"})),s.a.createElement("div",{className:"password"},s.a.createElement("label",{htmlFor:"RegistrationForm__password"},"Password ",s.a.createElement(C,null)),s.a.createElement(A,{name:"password",type:"password",required:!0,id:"RegistrationForm__password"})),s.a.createElement("div",{className:"nick_name"},s.a.createElement("label",{htmlFor:"RegistrationForm__nick_name"},"Nickname"),s.a.createElement(A,{name:"nick_name",type:"text",required:!0,id:"RegistrationForm__nick_name"})),s.a.createElement(x,{type:"submit"},"Register"))}}]),t}(o.Component);J.defaultProps={onRegistrationSuccess:function(){}};var M=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).handleRegistrationSuccess=function(e){n.props.history.push("/login")},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement(P,{className:"RegistrationPage"},s.a.createElement("h2",null,"Register"),s.a.createElement(J,{onRegistrationSuccess:this.handleRegistrationSuccess}))}}]),t}(o.Component);M.defaultProps={history:{push:function(){}}};var H=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement(P,{className:"NotFoundPage"},s.a.createElement("h2",null,"404 - Page not found"),s.a.createElement("p",null,"Try going back to your previous page."))}}]),t}(o.Component),Q=(n(202),{getFoods:function(){return fetch("".concat(j,"/foods")).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})}}),z={getIngredients:function(){return fetch("".concat(j,"/ingredients")).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})}},G={getRatings:function(){return fetch("".concat(j,"/ratings")).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},getUserRatedFoods:function(e){return fetch("".concat(j,"/ratings/users?userid=").concat(e),{method:"GET",headers:{authorization:"bearer ".concat(L.getAuthToken()),"content-type":"application/json"}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},postRating:function(e,t,n){return fetch("".concat(j,"/ratings/foods/").concat(e),{method:"POST",headers:{authorization:"bearer ".concat(L.getAuthToken()),"content-type":"application/json"},body:JSON.stringify({foodid:e,rating:n,userid:t})}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})}},W=n(82),K=(n(203),function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).checkRated=function(){var e=n.props.food;return n.context.userRatedFoods.filter(function(t){return t.foodid=e.id}).length>0},n.handleSubmit=function(e){e.preventDefault();var t=e.target[0].checked?1:-1,a=n.props.food,r=localStorage.getItem("userid");G.postRating(a.id,r,t).then(function(){return G.getRatings()}).then(function(e){n.context.setRatingsList(e)}).then(function(){return G.getUserRatedFoods(window.localStorage.getItem("userid"))}).then(n.context.setUserRatedFoods).catch(n.context.setError)},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"renderRatingDisabled",value:function(){return s.a.createElement("form",{className:"FoodListItem__Rating",onSubmit:this.handleSubmit},s.a.createElement("input",{type:"radio",name:"rating_thumb",value:"1",className:"form-rating-input",disabled:!0})," ","Thumbs Up",s.a.createElement("input",{type:"radio",name:"rating_thumb",value:"-1",className:"form-rating-input",disabled:!0})," ","Thumbs Down",s.a.createElement(x,{type:"submit",disabled:!0},"Post rating"))}},{key:"renderRatingEnabled",value:function(){return s.a.createElement("form",{className:"FoodListItem__Rating",onSubmit:this.handleSubmit},s.a.createElement("input",{type:"radio",name:"rating_thumb",value:"1",className:"form-rating-input"})," ","Thumbs Up",s.a.createElement("input",{type:"radio",name:"rating_thumb",value:"-1",className:"form-rating-input"})," ","Thumbs Down",s.a.createElement(x,{type:"submit"},"Post rating"))}},{key:"render",value:function(){return this.checkRated()?this.renderRatingDisabled():this.renderRatingEnabled()}}]),t}(o.Component));K.contextType=p;n(204);var V=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.food,n=e.ingredients,a=e.ratings.filter(function(e){return e.foodid===t.id}),r=Object(W.a)(a,1)[0];return s.a.createElement("section",{className:"FoodListItem"},s.a.createElement("div",{className:"FoodListItem__details"},s.a.createElement("div",{className:"FoodListItem__text"},s.a.createElement("h2",{className:"FoodListItem__heading"},t.brand," ",t.variety," dinner"),s.a.createElement("ul",{className:"FoodListItem__composites"},s.a.createElement("li",{className:"FoodListItem__kcal"},t.kcal),s.a.createElement("li",{className:"FoodListItem__grade"},t.grade),s.a.createElement("li",{className:"FoodListItem__rating"},r.rating),s.a.createElement(K,{food:t})),s.a.createElement("ul",{className:"FoodListItem__ingredients"},s.a.createElement("h3",null,"Ingredients:"),s.a.createElement("li",{className:"FoodListItem__ingredient"},n[t.i1-1].name),s.a.createElement("li",{className:"FoodListItem__ingredient"},n[t.i2-1].name),s.a.createElement("li",{className:"FoodListItem__ingredient"},n[t.i3-1].name),s.a.createElement("li",{className:"FoodListItem__ingredient"},n[t.i4-1].name),s.a.createElement("li",{className:"FoodListItem__ingredient"},n[t.i5-1].name)))))}}]),t}(o.Component),X=(n(205),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.context.clearError(),Q.getFoods().then(this.context.setFoodList).catch(this.context.setError),z.getIngredients().then(this.context.setIngredientsList).catch(this.context.setError),G.getRatings().then(this.context.setRatingsList).catch(this.context.setError),G.getUserRatedFoods(window.localStorage.getItem("userid")).then(this.context.setUserRatedFoods).catch(this.context.setError)}},{key:"renderFoods",value:function(){var e=this.context,t=e.foodList,n=void 0===t?null:t,a=e.ingredientsList,r=void 0===a?null:a,o=e.ratingsList,i=void 0===o?null:o,c=e.userRatedFoods,l=void 0===c?null:c,u=e.query,m=void 0===u?null:u;return n&&r&&i&&l?m?n.filter(function(e){return e.variety.includes(m)}).map(function(e){return s.a.createElement(V,{key:e.id,food:e,ingredients:r,ratings:i})}):n.map(function(e){return s.a.createElement(V,{key:e.id,food:e,ingredients:r,ratings:i})}):s.a.createElement("section",{className:"foodlist"},s.a.createElement("span",{className:"status-text"},"Loading from server..."))}},{key:"render",value:function(){var e=this.context.error;return s.a.createElement(P,{list:!0,className:"FoodList"},e?s.a.createElement("p",{className:"red"},"There was an error, try again"):this.renderFoods())}}]),t}(o.Component));X.contextType=p;var Y=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault();var t=e.target[0].value;n.context.setQuery(t)},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement("section",{className:"search"},s.a.createElement("form",{className:"search-form",onSubmit:this.handleSubmit},s.a.createElement("label",{htmlFor:"search"},"Search"),s.a.createElement("input",{type:"text",className:"search",placeholder:"Search for Food..."})),s.a.createElement(X,null))}}]),t}(o.Component);Y.contextType=p;var Z=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement("section",{className:"sign-in-page"},s.a.createElement(l.b,{to:"/search"},"Search Foods"),s.a.createElement("section",{className:"mission-statement"},s.a.createElement("p",{className:"problem"},"Pet food shopping is hard, the process of searching for foods that have the right ingredients and none of the wrong ones takes long enough. Calculating how many dollars per calorie per day your pet consumes can vary wildly from one diet to the next, and is critical in budgeting how many dollars go towards Coco and Felix."),"   ",s.a.createElement("p",{className:"solution"},"Pet Food Shopper is here to simplify this process, removing the need for a spreadsheet to effectively price shop pet diets. In addition, you won't need a pet nutritionist to know what that pet food label is really telling you.")),s.a.createElement("img",{src:"https://cdn.theatlantic.com/assets/media/img/mt/2018/10/GettyImages_521915123/lead_720_405.jpg",alt:"dog-eating-food"}))}}]),t}(o.Component),$=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={hasError:!1},n.logoutFromIdle=function(){L.clearAuthToken(),L.clearUserMetadata(),L.clearCallbackBeforeExpiry(),F.unRegisterIdleResets(),n.forceUpdate()},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){F.setIdleCallback(this.logoutFromIdle),L.hasAuthToken()&&(this.context.updateLoggedIn(),F.registerIdleTimerResets(),L.queueCallbackBeforeExpiry(function(){q.postRefreshToken()}))}},{key:"componentWillUnmount",value:function(){F.unRegisterIdleResets(),L.clearCallbackBeforeExpiry()}},{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(R,{className:"App__header"}),s.a.createElement("main",{className:"App__main"},s.a.createElement(E.d,{className:"left-panel"},s.a.createElement(E.b,{exact:!0,path:"/",component:Z}),s.a.createElement(T,{path:"/login",component:D}),s.a.createElement(T,{path:"/register",component:M}),s.a.createElement(S,{path:"/search",component:Y}),s.a.createElement(E.b,{component:H}))))}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{hasError:!0}}}]),t}(o.Component);$.contextType=p;var ee=$;n(206);c.a.render(s.a.createElement(l.a,null,s.a.createElement(b,null,s.a.createElement(ee,null))),document.getElementById("root"))},83:function(e,t,n){e.exports=n(207)},90:function(e,t,n){}},[[83,1,2]]]);
//# sourceMappingURL=main.8c528912.chunk.js.map